name: Generate and Deploy

on:
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout app repo (scripts, Hugo, layouts, PaperMod theme)
      - name: Checkout genWtao-app
        uses: actions/checkout@v4
        with:
          path: genWtao-app
          submodules: true

      # 2. Checkout Logseq graph (source .md pages + site.yaml)
      - name: Checkout genWtao-graph
        uses: actions/checkout@v4
        with:
          repository: shamantao/genWtao-graph
          token: ${{ secrets.GH_TOKEN }}
          path: genWtao-graph

      # 3. Setup Python + dependencies
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install Python deps
        run: pip install pyyaml

      # 4. Export Logseq → Hugo content
      #    --config reads engine config (co      #    --config reads engine config (co      #    --config reads engine config (co      #    --config reads engine confi        #    --config readtho   g      #    --configlog    to      #    --confi        #    --config reads \
      #          #          #          #          #          #          #      p/      #          #          #    --site   genWtao-graph/site.yaml \
            --c            --c           o
            --c                         --c                         --c                   ugo-version: '0.156.0'
          extend          extend          extend
              B              B              B              _FORMSPREE_ID: ${{ secrets.FORMSPREE_ID }}
        run: |
          cd gen          cd gen          cd gen     


         cd gen         ntials from site.yaml
      - name: Read hosting confi      - name: Read hosting confun:      - name: Read hosting conf         - name: Read hosting conpen('genWtao-graph/site.yaml') as f:
                                                                                                                                                                                                                                                                                                                                                                                                                                               )"                                         o                                                                                                            server                                                  username: ${{ steps.hosting.outputs.ftp_user }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./genWtao-app/site/public/
          server-dir: /htdoc          server-dir: /htdoc          server
                               un: echo "Site deployed successfully"

      - name: Error details
        if: failure()
        run: echo "Deployment failed — check logs above"
