{{/*
  contact/list.html â€” contact form with Formspree
  Multilingual labels via Hugo i18n (site/i18n/*.yaml).
  FORMSPREE_ID injected at build time via HUGO_PARAMS_FORMSPREE_ID env var
  (GitHub Actions) or set directly in site/hugo.yaml params for local testing.
*/}}
{{ define "main" }}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    {{- with .Description }}<p class="post-description">{{ . }}</p>{{ end }}
  </header>

  <div class="post-content contact-page">
    {{- with .Content }}{{ . }}{{ end }}

    {{- $formspree := site.Params.formspree_id }}
    {{- if $formspree }}
    <form
      action="https://formspree.io/f/{{ $formspree }}"
      method="POST"
      class="contact-form"
    >
      <div class="form-group">
        <label for="contact-name">{{ i18n "contact_name" }}</label>
        <input
          type="text"
          id="contact-name"
          name="name"
          autocomplete="name"
          required
        >
      </div>

      <div class="form-group">
        <label for="contact-email">{{ i18n "contact_email" }}</label>
        <input
          type="email"
          id="contact-email"
          name="_replyto"
          autocomplete="email"
          required
        >
      </div>

      <div class="form-group">
        <label for="contact-message">{{ i18n "contact_message" }}</label>
        <textarea
          id="contact-message"
          name="message"
          rows="6"
          required
        ></textarea>
      </div>

      {{/* Redirect Formspree to the same page after submission */}}
      <input type="hidden" name="_next" value="{{ .Permalink }}?sent=1">

      <button type="submit" class="contact-submit">
        {{ i18n "contact_submit" }}
      </button>
    </form>

    {{/* Success message shown when ?sent=1 is in the URL */}}
    <p class="contact-success" id="contact-success-msg" style="display:none">
      {{ i18n "contact_success" }}
    </p>
    <script>
      if (window.location.search.includes('sent=1')) {
        document.getElementById('contact-success-msg').style.display = 'block';
        document.querySelector('.contact-form').style.display = 'none';
      }
    </script>

    {{- else }}
    <p><em>Contact form not configured (FORMSPREE_ID missing).</em></p>
    {{- end }}
  </div>
</article>
{{ end }}
